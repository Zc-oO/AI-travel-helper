<!--pages/assistant/assistant.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">æ—…è¡ŒåŠ©æ‰‹</view>
    <view class="location-info" wx:if="{{currentLocation}}">
      <text class="location-icon">ğŸ“</text>
      <text class="location-text">{{currentLocation}}</text>
    </view>
  </view>

  <!-- èŠå¤©åŒºåŸŸ -->
  <scroll-view 
    class="chat-area" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}"
    scroll-into-view="{{scrollIntoView}}"
  >
    <!-- æ¬¢è¿æ¶ˆæ¯ -->
    <view class="welcome-message" wx:if="{{messages.length === 0}}">
      <view class="welcome-avatar">ğŸ¤–</view>
      <view class="welcome-text">
        <view class="welcome-title">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIæ—…è¡ŒåŠ©æ‰‹</view>
        <view class="welcome-subtitle">æˆ‘å¯ä»¥ä¸ºä½ æ¨èå½“åœ°çš„ç¾é£Ÿã€æ™¯ç‚¹ã€ä½å®¿ç­‰</view>
      </view>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <view class="messages-list">
      <view 
        class="message-item {{item.type}}"
        wx:for="{{messages}}"
        wx:key="id"
        id="msg-{{item.id}}"
      >
        <!-- AIæ¶ˆæ¯ -->
        <view class="message-content" wx:if="{{item.type === 'ai'}}">
          <view class="avatar ai-avatar">ğŸ¤–</view>
          <view class="message-bubble ai-bubble">
            <text class="message-text">{{item.content}}</text>
            <view class="message-time">{{item.time}}</view>
            
            <!-- æ¨èå¡ç‰‡ -->
            <view class="recommendations" wx:if="{{item.recommendations}}">
              <view 
                class="rec-card"
                wx:for="{{item.recommendations}}"
                wx:for-item="rec"
                wx:key="id"
                bindtap="selectRecommendation"
                data-rec="{{rec}}"
              >
                <image class="rec-image" src="{{rec.image || '/images/default-rec.jpg'}}" mode="aspectFill" />
                <view class="rec-info">
                  <view class="rec-name">{{rec.name}}</view>
                  <view class="rec-type">{{rec.type}}</view>
                  <view class="rec-rating">{{rec.rating}} â­</view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view class="message-content" wx:if="{{item.type === 'user'}}">
          <view class="message-bubble user-bubble">
            <text class="message-text">{{item.content}}</text>
            <view class="message-time">{{item.time}}</view>
          </view>
          <view class="avatar user-avatar">ğŸ‘¤</view>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-message" wx:if="{{isTyping}}">
        <view class="avatar ai-avatar">ğŸ¤–</view>
        <view class="typing-indicator">
          <view class="typing-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- å¿«æ·æ¨è -->
  <view class="quick-suggestions" wx:if="{{quickSuggestions.length > 0 && messages.length === 0}}">
    <view class="suggestions-title">ä½ å¯ä»¥è¿™æ ·é—®æˆ‘ï¼š</view>
    <view class="suggestions-list">
      <view 
        class="suggestion-item"
        wx:for="{{quickSuggestions}}"
        wx:key="*this"
        bindtap="sendQuickMessage"
        data-message="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-container">
      <input 
        class="message-input"
        placeholder="è¯·å‘Šè¯‰æˆ‘ä½ æƒ³äº†è§£ä»€ä¹ˆ..."
        value="{{inputText}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        confirm-type="send"
        disabled="{{isTyping}}"
      />
      <button 
        class="send-button {{inputText ? 'active' : ''}}" 
        bindtap="sendMessage"
        disabled="{{!inputText || isTyping}}"
      >
        å‘é€
      </button>
    </view>
    
    <!-- åŠŸèƒ½æŒ‰é’® -->
    <view class="function-buttons">
      <view class="function-btn" bindtap="requestLocation">
        <text class="btn-icon">ğŸ“</text>
        <text class="btn-text">è·å–ä½ç½®</text>
      </view>
      <view class="function-btn" bindtap="recommendRestaurant">
        <text class="btn-icon">ğŸ½ï¸</text>
        <text class="btn-text">æ¨èç¾é£Ÿ</text>
      </view>
      <view class="function-btn" bindtap="recommendAttraction">
        <text class="btn-icon">ğŸ¯</text>
        <text class="btn-text">æ¨èæ™¯ç‚¹</text>
      </view>
      <view class="function-btn" bindtap="recommendHotel">
        <text class="btn-icon">ğŸ¨</text>
        <text class="btn-text">æ¨èä½å®¿</text>
      </view>
    </view>
  </view>
</view>